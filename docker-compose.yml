# BookingCare Microservices - Full Docker Compose
# Sử dụng: docker-compose -f docker-compose-full.yml up -d

version: "3.8"

services:
  # Infrastructure
  rabbitmq:
    image: rabbitmq:3.12-management
    platform: linux/amd64
    container_name: bookingcare_rabbitmq
    hostname: rabbitmq
    ports:
      - "5672:5672"
      - "15672:15672"
    environment:
      - RABBITMQ_DEFAULT_USER=${RABBITMQ_DEFAULT_USER}
      - RABBITMQ_DEFAULT_PASS=${RABBITMQ_DEFAULT_PASS}
      - RABBITMQ_DEFAULT_VHOST=${RABBITMQ_DEFAULT_VHOST}
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
    networks:
      - bookingcare-network
    healthcheck:
      test: ["CMD", "rabbitmq-diagnostics", "-q", "ping"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    platform: linux/amd64
    container_name: bookingcare_redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - bookingcare-network
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 3
    restart: unless-stopped

  mongodb:
    image: mongo:7
    platform: linux/amd64
    container_name: bookingcare_mongodb
    ports:
      - "27017:27017"
    environment:
      - MONGO_INITDB_ROOT_USERNAME=${MONGO_INITDB_ROOT_USERNAME}
      - MONGO_INITDB_ROOT_PASSWORD=${MONGO_INITDB_ROOT_PASSWORD}
    volumes:
      - mongodb_data:/data/db
    networks:
      - bookingcare-network
    healthcheck:
      test: echo 'db.runCommand("ping").ok' | mongosh localhost:27017/test --quiet
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 40s
    restart: unless-stopped

  # SQL Server Databases
  sqlserver-discount:
    image: mcr.microsoft.com/azure-sql-edge:latest
    # platform: linux/amd64
    container_name: bookingcare_sqlserver_discount
    ports:
      - "1434:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${SQLSERVER_DISCOUNT_PASSWORD}
      - MSSQL_PID=Developer
    volumes:
      - sqlserver_discount_data:/var/opt/mssql
    networks:
      - bookingcare-network
    healthcheck:
      test:
        ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/1433' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
    restart: unless-stopped

  sqlserver-saga:
    image: mcr.microsoft.com/azure-sql-edge:latest
    # platform: linux/amd64
    container_name: bookingcare_sqlserver_saga
    ports:
      - "1400:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${SQLSERVER_SAGA_PASSWORD}
      - MSSQL_PID=Developer
    volumes:
      - sqlserver_saga_data:/var/opt/mssql
    networks:
      - bookingcare-network
    healthcheck:
      test:
        ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/1433' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
    restart: unless-stopped

  sqlserver-user:
    image: mcr.microsoft.com/azure-sql-edge:latest
    # platform: linux/amd64
    container_name: bookingcare_sqlserver_user
    ports:
      - "1445:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${SQLSERVER_USER_PASSWORD}
      - MSSQL_PID=Developer
    volumes:
      - sqlserver_user_data:/var/opt/mssql
    networks:
      - bookingcare-network
    healthcheck:
      test:
        ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/1433' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
    restart: unless-stopped

  sqlserver-doctor:
    image: mcr.microsoft.com/azure-sql-edge:latest
    # platform: linux/amd64
    container_name: bookingcare_sqlserver_doctor
    ports:
      - "1447:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${SQLSERVER_DOCTOR_PASSWORD}
      - MSSQL_PID=Developer
    volumes:
      - sqlserver_doctor_data:/var/opt/mssql
    networks:
      - bookingcare-network
    healthcheck:
      test:
        ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/1433' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
    restart: unless-stopped

  sqlserver-auth:
    image: mcr.microsoft.com/azure-sql-edge:latest
    # platform: linux/amd64
    container_name: bookingcare_sqlserver_auth
    ports:
      - "1449:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${SQLSERVER_AUTH_PASSWORD}
      - MSSQL_PID=Developer
    volumes:
      - sqlserver_auth_data:/var/opt/mssql
    networks:
      - bookingcare-network
    healthcheck:
      test:
        ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/1433' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
    restart: unless-stopped

  sqlserver-appointment:
    image: mcr.microsoft.com/azure-sql-edge:latest
    # platform: linux/amd64
    container_name: bookingcare_sqlserver_appointment
    ports:
      - "1450:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${SQLSERVER_APPOINTMENT_PASSWORD}
      - MSSQL_PID=Developer
    volumes:
      - sqlserver_appointment_data:/var/opt/mssql
    networks:
      - bookingcare-network
    healthcheck:
      test:
        ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/1433' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
    restart: unless-stopped

  sqlserver-hospital:
    image: mcr.microsoft.com/azure-sql-edge:latest
    # platform: linux/amd64
    container_name: bookingcare_sqlserver_hospital
    ports:
      - "1448:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${SQLSERVER_HOSPITAL_PASSWORD}
      - MSSQL_PID=Developer
    volumes:
      - sqlserver_hospital_data:/var/opt/mssql
    networks:
      - bookingcare-network
    healthcheck:
      test:
        ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/1433' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
    restart: unless-stopped

  sqlserver-schedule:
    image: mcr.microsoft.com/azure-sql-edge:latest
    # platform: linux/amd64
    container_name: bookingcare_sqlserver_schedule
    ports:
      - "1446:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${SQLSERVER_SCHEDULE_PASSWORD}
      - MSSQL_PID=Developer
    volumes:
      - sqlserver_schedule_data:/var/opt/mssql
    networks:
      - bookingcare-network
    healthcheck:
      test:
        ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/1433' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
    restart: unless-stopped

  sqlserver-payment:
    image: mcr.microsoft.com/azure-sql-edge:latest
    # platform: linux/amd64
    container_name: bookingcare_sqlserver_payment
    ports:
      - "1451:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${SQLSERVER_PAYMENT_PASSWORD}
      - MSSQL_PID=Developer
    volumes:
      - sqlserver_payment_data:/var/opt/mssql
    networks:
      - bookingcare-network
    healthcheck:
      test:
        ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/1433' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
    restart: unless-stopped

  sqlserver-servicemedical:
    image: mcr.microsoft.com/azure-sql-edge:latest
    # platform: linux/amd64
    container_name: bookingcare_sqlserver_servicemedical
    ports:
      - "1452:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${SQLSERVER_SERVICEMEDICAL_PASSWORD}
      - MSSQL_PID=Developer
    volumes:
      - sqlserver_servicemedical_data:/var/opt/mssql
    networks:
      - bookingcare-network
    healthcheck:
      test:
        ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/1433' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
    restart: unless-stopped

  sqlserver-ai:
    image: mcr.microsoft.com/azure-sql-edge:latest
    # platform: linux/amd64
    container_name: bookingcare_sqlserver_ai
    ports:
      - "1453:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${SQLSERVER_AI_PASSWORD}
      - MSSQL_PID=Developer
    volumes:
      - sqlserver_ai_data:/var/opt/mssql
    networks:
      - bookingcare-network
    healthcheck:
      test:
        ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/1433' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
    restart: unless-stopped

  sqlserver-content:
    image: mcr.microsoft.com/azure-sql-edge:latest
    # platform: linux/amd64
    container_name: bookingcare_sqlserver_content
    ports:
      - "1454:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=${SQLSERVER_CONTENT_PASSWORD}
      - MSSQL_PID=Developer
    volumes:
      - sqlserver_content_data:/var/opt/mssql
    networks:
      - bookingcare-network
    healthcheck:
      test:
        ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/127.0.0.1/1433' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
    restart: unless-stopped

  # Monitoring Stack
  prometheus:
    image: prom/prometheus:latest
    container_name: bookingcare_prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
      - ./monitoring/prometheus/alert.rules.yml:/etc/prometheus/alert.rules.yml
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/usr/share/prometheus/console_libraries'
      - '--web.console.templates=/usr/share/prometheus/consoles'
      - '--web.enable-lifecycle'
    networks:
      - bookingcare-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:9090/-/healthy"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: unless-stopped
    depends_on:
      - redis
      - mongodb
      - rabbitmq

  grafana:
    image: grafana/grafana:latest
    container_name: bookingcare_grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_USER=${GRAFANA_ADMIN_USER:-admin}
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_ADMIN_PASSWORD:-admin}
      - GF_INSTALL_PLUGINS=grafana-piechart-panel
      - GF_USERS_ALLOW_SIGN_UP=false
      - GF_SERVER_ROOT_URL=http://localhost:3000
    volumes:
      - grafana_data:/var/lib/grafana
      - ./monitoring/grafana/provisioning:/etc/grafana/provisioning
      - ./monitoring/grafana/dashboards:/var/lib/grafana/dashboards
    networks:
      - bookingcare-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: unless-stopped
    depends_on:
      - prometheus

  node-exporter:
    image: prom/node-exporter:latest
    container_name: bookingcare_node_exporter
    ports:
      - "9100:9100"
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - '--path.procfs=/host/proc'
      - '--path.sysfs=/host/sys'
      - '--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'
    networks:
      - bookingcare-network
    restart: unless-stopped

  redis-exporter:
    image: oliver006/redis_exporter:latest
    container_name: bookingcare_redis_exporter
    ports:
      - "9121:9121"
    environment:
      - REDIS_ADDR=redis://redis:6379
    networks:
      - bookingcare-network
    depends_on:
      - redis
    restart: unless-stopped

  # mongodb-exporter:
  #   image: percona/mongodb_exporter:latest
  #   container_name: bookingcare_mongodb_exporter
  #   ports:
  #     - "9216:9216"
  #   environment:
  #     - MONGODB_URI=mongodb://${MONGO_INITDB_ROOT_USERNAME}:${MONGO_INITDB_ROOT_PASSWORD}@mongodb:27017/?authSource=admin
  #   command:
  #     - '--mongodb.uri=$(MONGODB_URI)'
  #     - '--collect-all'
  #   networks:
  #     - bookingcare-network
  #   depends_on:
  #     - mongodb
  #   restart: unless-stopped

  # mssql-exporter:
  #   image: awaragi/prometheus-mssql-exporter:latest
  #   container_name: bookingcare_mssql_exporter
  #   ports:
  #     - "4000:4000"
  #   environment:
  #     - MSSQL_SERVER=sqlserver-discount,sqlserver-saga,sqlserver-user,sqlserver-doctor,sqlserver-auth,sqlserver-appointment,sqlserver-hospital,sqlserver-schedule,sqlserver-payment,sqlserver-servicemedical,sqlserver-ai,sqlserver-content
  #     - MSSQL_PORT=1433
  #     - MSSQL_USERNAME=sa
  #     - MSSQL_PASSWORD=${SQLSERVER_DISCOUNT_PASSWORD}
  #     - MSSQL_ENCRYPT=false
  #   networks:
  #     - bookingcare-network
  #   depends_on:
  #     - sqlserver-discount
  #     - sqlserver-saga
  #     - sqlserver-user
  #     - sqlserver-doctor
  #     - sqlserver-auth
  #     - sqlserver-appointment
  #     - sqlserver-hospital
  #     - sqlserver-schedule
  #     - sqlserver-payment
  #     - sqlserver-servicemedical
  #     - sqlserver-ai
  #     - sqlserver-content
  #   restart: unless-stopped

  # Microservices
  api-gateway:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-api-gateway:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_api_gateway
    ports:
      - "5001:5001"
    depends_on:
      - auth-service
      - user-service
      - doctor-service
      - hospital-service
      - appointment-service
      - payment-service
      - review-service
      - content-service
      - discount-service
      - communication-service
      - notification-service
      - favorites-service
      - analytics-service
      - schedule-service
      - servicemedical-service
      - saga-service
      - ai-service
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:5001
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
    networks:
      - bookingcare-network
    restart: unless-stopped

  ai-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-ai-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_ai_service
    ports:
      - "6001:6001"
      - "6101:6101"
    depends_on:
      sqlserver-ai:
        condition: service_healthy
      sqlserver-appointment:
        condition: service_healthy
      sqlserver-payment:
        condition: service_healthy
      sqlserver-doctor:
        condition: service_healthy
      sqlserver-hospital:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6001;http://+:6101
      # Connection Strings
      - ConnectionStrings__DefaultConnection=${AI_CONNECTION_STRING}
      - ConnectionStrings__AppointmentConnection=${APPOINTMENT_CONNECTION_STRING}
      - ConnectionStrings__PaymentConnection=${PAYMENT_CONNECTION_STRING}
      - ConnectionStrings__DoctorConnection=${DOCTOR_CONNECTION_STRING}
      - ConnectionStrings__HospitalConnection=${HOSPITAL_CONNECTION_STRING}
      # JWT
      - Jwt__Key=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      # RabbitMQ
      - RabbitMQ__HostName=${RABBITMQ_HOSTNAME}
      - RabbitMQ__Port=${RABBITMQ_PORT}
      - RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
      - RabbitMQ__Password=${RABBITMQ_DEFAULT_PASS}
      - RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
      - RabbitMQ__ExchangeName=booking_care_event_bus
      - RabbitMQ__QueueName=ai-service-queue
      - RabbitMQ__RetryCount=3
      - RabbitMQ__ConnectionTimeout=30000
      - RabbitMQ__RequestedHeartbeat=60
      - RabbitMQ__AutomaticRecoveryEnabled=true
      - RabbitMQ__NetworkRecoveryInterval=5000
      - RabbitMQ__PersistentMessages=true
      - RabbitMQ__AutoDeleteQueue=false
      - RabbitMQ__DurableQueue=true
      - RabbitMQ__ExclusiveQueue=false
      # Gemini Base Configuration
      - Gemini__ApiEndpoint=${GEMINI_API_ENDPOINT}
      - Gemini__Temperature=${GEMINI_TEMPERATURE}
      - Gemini__MaxTokens=${GEMINI_MAX_TOKENS}
      - Gemini__TopK=${GEMINI_TOP_K}
      - Gemini__TopP=${GEMINI_TOP_P}
      # Gemini Services
      - GeminiServices__SymptomAnalysis__ApiKey=${GEMINI_SYMPTOM_ANALYSIS_API_KEY}
      - GeminiServices__SymptomAnalysis__PrimaryModel=${GEMINI_SYMPTOM_ANALYSIS_PRIMARY_MODEL}
      - GeminiServices__SymptomAnalysis__FallbackModel=${GEMINI_SYMPTOM_ANALYSIS_FALLBACK_MODEL}
      - GeminiServices__SymptomAnalysis__MaxTokens=${GEMINI_SYMPTOM_ANALYSIS_MAX_TOKENS}
      - GeminiServices__LabResultAnalysis__ApiKey=${GEMINI_LAB_RESULT_API_KEY}
      - GeminiServices__LabResultAnalysis__PrimaryModel=${GEMINI_LAB_RESULT_PRIMARY_MODEL}
      - GeminiServices__LabResultAnalysis__FallbackModel=${GEMINI_LAB_RESULT_FALLBACK_MODEL}
      - GeminiServices__LabResultAnalysis__MaxTokens=${GEMINI_LAB_RESULT_MAX_TOKENS}
      - GeminiServices__DermatologyAnalysis__ApiKey=${GEMINI_DERMATOLOGY_API_KEY}
      - GeminiServices__DermatologyAnalysis__PrimaryModel=${GEMINI_DERMATOLOGY_PRIMARY_MODEL}
      - GeminiServices__DermatologyAnalysis__FallbackModel=${GEMINI_DERMATOLOGY_FALLBACK_MODEL}
      - GeminiServices__MedicalSummary__ApiKey=${GEMINI_MEDICAL_SUMMARY_API_KEY}
      - GeminiServices__MedicalSummary__PrimaryModel=${GEMINI_MEDICAL_SUMMARY_PRIMARY_MODEL}
      - GeminiServices__MedicalSummary__FallbackModel=${GEMINI_MEDICAL_SUMMARY_FALLBACK_MODEL}
      # Groq Base Configuration
      - Groq__ApiEndpoint=${GROQ_API_ENDPOINT}
      - Groq__ApiKey=${GROQ_API_KEY}
      - Groq__AskingModel=${GROQ_ASKING_MODEL}
      - Groq__ConclusionModel=${GROQ_CONCLUSION_MODEL}
      - Groq__Temperature=${GROQ_TEMPERATURE}
      - Groq__MaxTokens=${GROQ_MAX_TOKENS}
      - Groq__MaxRetries=${GROQ_MAX_RETRIES}
      - Groq__TimeoutSeconds=${GROQ_TIMEOUT_SECONDS}
      - Groq__Enabled=${GROQ_ENABLED}
      # Groq Services
      - GroqServices__SymptomAnalysis__ApiKey=${GROQ_SYMPTOM_ANALYSIS_API_KEY}
      - GroqServices__SymptomAnalysis__PrimaryModel=${GROQ_SYMPTOM_ANALYSIS_PRIMARY_MODEL}
      - GroqServices__SymptomAnalysis__FallbackModel=${GROQ_SYMPTOM_ANALYSIS_FALLBACK_MODEL}
      - GroqServices__SymptomAnalysis__MaxTokens=${GROQ_SYMPTOM_ANALYSIS_MAX_TOKENS}
      - GroqServices__LabResultAnalysis__ApiKey=${GROQ_LAB_RESULT_API_KEY}
      - GroqServices__LabResultAnalysis__PrimaryModel=${GROQ_LAB_RESULT_PRIMARY_MODEL}
      - GroqServices__LabResultAnalysis__FallbackModel=${GROQ_LAB_RESULT_FALLBACK_MODEL}
      - GroqServices__LabResultAnalysis__MaxTokens=${GROQ_LAB_RESULT_MAX_TOKENS}
      - GroqServices__DermatologyAnalysis__ApiKey=${GROQ_DERMATOLOGY_API_KEY}
      - GroqServices__DermatologyAnalysis__PrimaryModel=${GROQ_DERMATOLOGY_PRIMARY_MODEL}
      - GroqServices__DermatologyAnalysis__FallbackModel=${GROQ_DERMATOLOGY_FALLBACK_MODEL}
      - GroqServices__MedicalSummary__ApiKey=${GROQ_MEDICAL_SUMMARY_API_KEY}
      - GroqServices__MedicalSummary__PrimaryModel=${GROQ_MEDICAL_SUMMARY_PRIMARY_MODEL}
      - GroqServices__MedicalSummary__FallbackModel=${GROQ_MEDICAL_SUMMARY_FALLBACK_MODEL}
      - GroqServices__InsightsSummary__ApiKey=${GROQ_INSIGHTS_SUMMARY_API_KEY}
      - GroqServices__InsightsSummary__PrimaryModel=${GROQ_INSIGHTS_SUMMARY_PRIMARY_MODEL}
      - GroqServices__InsightsSummary__FallbackModel=${GROQ_INSIGHTS_SUMMARY_FALLBACK_MODEL}
      - GroqServices__InsightsSummary__MaxTokens=${GROQ_INSIGHTS_SUMMARY_MAX_TOKENS}
      - GroqServices__InsightsSummary__Temperature=${GROQ_INSIGHTS_SUMMARY_TEMPERATURE}
      - GroqServices__InsightsSummary__TimeoutSeconds=${GROQ_INSIGHTS_SUMMARY_TIMEOUT_SECONDS}
      - GroqServices__NutritionService__ApiKey=${GROQ_NUTRITION_API_KEY}
      - GroqServices__NutritionService__PrimaryModel=${GROQ_NUTRITION_PRIMARY_MODEL}
      - GroqServices__NutritionService__FallbackModel=${GROQ_NUTRITION_FALLBACK_MODEL}
      - GroqServices__NutritionService__MaxTokens=${GROQ_NUTRITION_MAX_TOKENS}
      - GroqServices__NutritionService__TimeoutSeconds=${GROQ_NUTRITION_TIMEOUT_SECONDS}
      # AILabTools
      - AILabTools__ApiBaseUrl=${AILABTOOLS_API_BASE_URL}
      - AILabTools__RequestTimeoutSeconds=${AILABTOOLS_REQUEST_TIMEOUT_SECONDS}
      - AILabTools__MaxImageSizeBytes=${AILABTOOLS_MAX_IMAGE_SIZE_BYTES}
      - AILabTools__MaxImageResolution=${AILABTOOLS_MAX_IMAGE_RESOLUTION}
      # AWS S3
      - AWS__S3__AccessKey=${S3_AI_ACCESS_KEY}
      - AWS__S3__SecretKey=${S3_AI_SECRET_KEY}
      - AWS__S3__BucketName=${S3_AI_BUCKET_NAME}
      - AWS__S3__Region=${S3_AI_REGION}
      - AWS__S3__CloudFrontDomain=${CLOUDFRONT_DOMAIN}
      - AWS__S3__CloudFrontDistributionId=${CLOUDFRONT_DISTRIBUTION_ID}
      - AWS__S3__PresignedUrlExpiryHours=1
      - AWS__S3__MaxFileSizeBytes=10485760
      - AWS__S3__FileUploadPath=uploads/
      # AWS CloudFront
      - AWS__CloudFront__DistributionId=${CLOUDFRONT_DISTRIBUTION_ID}
      - AWS__CloudFront__Domain=${CLOUDFRONT_DOMAIN}
      - AWS__CloudFront__CacheTtlSeconds=${CLOUDFRONT_CACHE_TTL_SECONDS}
      - AWS__CloudFront__EnableInvalidation=${CLOUDFRONT_ENABLE_INVALIDATION}
      # Tesseract OCR
      - Tesseract__DataPath=${TESSERACT_DATA_PATH}
      - Tesseract__Language=${TESSERACT_LANGUAGE}
      # Call Recordings
      - CallRecordings__UploadPath=${CALL_RECORDINGS_UPLOAD_PATH}
      - CallRecordings__MaxFileSizeBytes=${CALL_RECORDINGS_MAX_FILE_SIZE_BYTES}
      # Voice
      - Voice__MaxFileSizeBytes=${VOICE_MAX_FILE_SIZE_BYTES}
      - GrpcClients__Hospital__Address=http://hospital-service:6104
      - GrpcClients__Doctor__Address=http://doctor-service:6108
    networks:
      - bookingcare-network
    restart: unless-stopped

  analytics-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-analytics-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_analytics_service
    ports:
      - "6000:6000"
      - "6100:6100"
    depends_on:
      mongodb:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6000;http://+:6100
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - MongoDbSettings__ConnectionString=${MONGODB_CONNECTION_STRING}
      - MongoDbSettings__DatabaseName=MABS_Analytics
    networks:
      - bookingcare-network
    restart: unless-stopped

  appointment-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-appointment-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_appointment_service
    ports:
      - "6002:6002"
      - "6102:6102"
    depends_on:
      sqlserver-appointment:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6002;http://+:6102
      - ConnectionStrings__DefaultConnection=${APPOINTMENT_CONNECTION_STRING}
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - Cache__ConnectionString=${REDIS_CONNECTION_STRING}
      - RabbitMQ__HostName=${RABBITMQ_HOSTNAME}
      - RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
      - RabbitMQ__Password=${RABBITMQ_DEFAULT_PASS}
      - RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
      - Services__Doctor__GrpcUrl=http://doctor-service:6108
      - Services__User__GrpcUrl=http://user-service:6116
      - Services__Hospital__GrpcUrl=http://hospital-service:6104
      - Services__Service__GrpcUrl=http://servicemedical-service:6115
      - Services__Payment__GrpcUrl=http://payment-service:6188
      - AWS__S3__AccessKey=${S3_ACCESS_KEY}
      - AWS__S3__SecretKey=${S3_SECRET_KEY}
      - AWS__S3__BucketName=${S3_BUCKET_NAME}
      - AWS__S3__Region=${S3_REGION}
    networks:
      - bookingcare-network
    restart: unless-stopped

  auth-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-auth-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_auth_service
    ports:
      - "6003:6003"
      - "6103:6103"
    depends_on:
      sqlserver-auth:
        condition: service_healthy
      sqlserver-saga:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6003;http://+:6103
      - ConnectionStrings__DefaultConnection=${AUTH_CONNECTION_STRING}
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - RabbitMQ__HostName=${RABBITMQ_HOSTNAME}
      - RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
      - RabbitMQ__Password=${RABBITMQ_DEFAULT_PASS}
      - RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
      - Saga__ConnectionString=${SAGA_CONNECTION_STRING}
      - OtpVerification__Secret=${OTP_VERIFICATION_SECRET}
      - OtpVerification__GrpcEndpoint=http://notification-service:6110
      - Services__User__GrpcUrl=http://user-service:6116
      - Services__Doctor__GrpcUrl=http://doctor-service:6108
      - Services__Hospital__GrpcUrl=http://hospital-service:6104
      - ExternalAuth__Google__ClientId=${GOOGLE_CLIENT_ID}
      - ExternalAuth__Facebook__AppId=${FACEBOOK_APP_ID}
      - ExternalAuth__Facebook__AppSecret=${FACEBOOK_APP_SECRET}
      - FrontendOptions__Client__BaseUrl=${FRONTEND_CLIENT_BASEURL}
      - FrontendOptions__Admin__BaseUrl=${FRONTEND_ADMIN_BASEURL}
      - FrontendOptions__Default__BaseUrl=${FRONTEND_DEFAULT_BASEURL}
      - FrontendOptions__HostMap__medcure.com.vn=${FRONTEND_HOSTMAP_CLIENT}
      - FrontendOptions__HostMap__admin.medcure.com.vn=${FRONTEND_HOSTMAP_ADMIN}
    networks:
      - bookingcare-network
    restart: unless-stopped

  communication-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-communication-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_communication_service
    ports:
      - "6005:6005"
      - "6105:6105"
    depends_on:
      mongodb:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6005;http://+:6105
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - MongoDB__ConnectionString=${MONGODB_CONNECTION_STRING}
      - MongoDB__DatabaseName=MABS_Communication
      - Cache__ConnectionString=${REDIS_CONNECTION_STRING}
      - RabbitMQ__HostName=${RABBITMQ_HOSTNAME}
      - RabbitMQ__Port=${RABBITMQ_PORT}
      - RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
      - RabbitMQ__Password=${RABBITMQ_DEFAULT_PASS}
      - RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
      - GrpcServices__AuthService__Url=http://auth-service:6103
      - GrpcServices__UserService__Url=http://user-service:6116
      - AWS__S3__AccessKey=${S3_ACCESS_KEY}
      - AWS__S3__SecretKey=${S3_SECRET_KEY}
      - AWS__S3__BucketName=${S3_BUCKET_NAME}
      - AWS__S3__Region=${S3_REGION}
    networks:
      - bookingcare-network
    restart: unless-stopped

  content-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-content-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_content_service
    ports:
      - "6006:6006"
      - "6106:6106"
    depends_on:
      sqlserver-content:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6006;http://+:6106
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - ConnectionStrings__DefaultConnection=${CONTENT_CONNECTION_STRING}
    networks:
      - bookingcare-network
    restart: unless-stopped

  discount-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-discount-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_discount_service
    ports:
      - "6007:6007"
      - "6017:6017"
    depends_on:
      sqlserver-discount:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6007;http://+:6017
      - ConnectionStrings__DefaultConnection=${DISCOUNT_CONNECTION_STRING}
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - RabbitMQ__HostName=${RABBITMQ_HOSTNAME}
      - RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
      - RabbitMQ__Password=${RABBITMQ_DEFAULT_PASS}
      - RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
    networks:
      - bookingcare-network
    restart: unless-stopped

  doctor-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-doctor-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_doctor_service
    ports:
      - "6008:6008"
      - "6108:6108"
    depends_on:
      sqlserver-doctor:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6008;http://+:6108
      - ConnectionStrings__DefaultConnection=${DOCTOR_CONNECTION_STRING}
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - RabbitMQ__HostName=${RABBITMQ_HOSTNAME}
      - RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
      - RabbitMQ__Password=${RABBITMQ_DEFAULT_PASS}
      - RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
      - AWS__S3__AccessKey=${S3_ACCESS_KEY}
      - AWS__S3__SecretKey=${S3_SECRET_KEY}
      - AWS__S3__BucketName=${S3_BUCKET_NAME}
      - AWS__S3__Region=${S3_REGION}
      - GrpcClients__Favorites__Address=http://favorites-service:6109
      - GrpcClients__Auth__Address=http://auth-service:6103
      - GrpcClients__Hopital__Address=http://hospital-service:6104
      - GrpcClients__Review__Address=http://review-service:6112
    networks:
      - bookingcare-network
    restart: unless-stopped

  favorites-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-favorites-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_favorites_service
    ports:
      - "6009:6009"
      - "6109:6109"
    depends_on:
      mongodb:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6009;http://+:6109
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - MongoDbSettings__ConnectionString=${MONGODB_CONNECTION_STRING}
      - MongoDbSettings__DatabaseName=MABS_Favorites
    networks:
      - bookingcare-network
    restart: unless-stopped

  hospital-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-hospital-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_hospital_service
    ports:
      - "6004:6004"
      - "6104:6104"
    depends_on:
      sqlserver-hospital:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6004;http://+:6104
      - ConnectionStrings__DefaultConnection=${HOSPITAL_CONNECTION_STRING}
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - RabbitMQ__HostName=${RABBITMQ_HOSTNAME}
      - RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
      - RabbitMQ__Password=${RABBITMQ_DEFAULT_PASS}
      - RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
      - AWS__S3__AccessKey=${S3_ACCESS_KEY}
      - AWS__S3__SecretKey=${S3_SECRET_KEY}
      - AWS__S3__BucketName=${S3_BUCKET_NAME}
      - AWS__S3__Region=${S3_REGION}
      - GrpcClients__Auth__Address=http://auth-service:6103
      - GrpcClients__Doctor__Address=http://doctor-service:6108
      - GrpcClients__ServiceMedical__Address=http://servicemedical-service:6115
      - GrpcClients__Review__Address=http://review-service:6112
      - GrpcClients__Notification__Address=http://notification-service:6110
    networks:
      - bookingcare-network
    restart: unless-stopped

  notification-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-notification-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_notification_service
    ports:
      - "6010:6010"
      - "6110:6110"
    depends_on:
      mongodb:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
      redis:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6010;http://+:6110
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - MongoDb__ConnectionString=${MONGODB_CONNECTION_STRING}
      - MongoDb__DatabaseName=MABS_Notification
      - RabbitMQ__HostName=${RABBITMQ_HOSTNAME}
      - RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
      - RabbitMQ__Password=${RABBITMQ_DEFAULT_PASS}
      - RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
      - Cache__ConnectionString=${REDIS_CONNECTION_STRING}
      - OtpVerification__Secret=${OTP_VERIFICATION_SECRET}
      - AuthService__GrpcUrl=http://auth-service:6103
    networks:
      - bookingcare-network
    restart: unless-stopped

  payment-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-payment-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_payment_service
    ports:
      - "6088:6088"
      - "6188:6188"
    depends_on:
      sqlserver-payment:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6088;http://+:6188
      - ConnectionStrings__DefaultConnection=${PAYMENT_CONNECTION_STRING}
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - RabbitMQ__HostName=${RABBITMQ_HOSTNAME}
      - RabbitMQ__Port=${RABBITMQ_PORT}
      - RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
      - RabbitMQ__Password=${RABBITMQ_DEFAULT_PASS}
      - RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
      - VNPayConfiguration__TmnCode=${VNPAY_TMN_CODE}
      - VNPayConfiguration__HashSecret=${VNPAY_HASH_SECRET}
      - PayOSConfiguration__ClientId=${PAYOS_CLIENT_ID}
      - PayOSConfiguration__ApiKey=${PAYOS_API_KEY}
      - PayOSConfiguration__ChecksumKey=${PAYOS_CHECKSUM_KEY}
      - PayOSConfiguration__ReturnUrl=${PAYOS_RETURN_URL}
      - PayOSConfiguration__CancelUrl=${PAYOS_CANCEL_URL}
      - PayOSConfiguration__TimeoutInMinutes=${PAYOS_TIMEOUT_IN_MINUTES}
      - PayOSConfiguration__CleanupIntervalMinutes=${PAYOS_CLEANUP_INTERVAL_MINUTES}
      - StripeConfiguration__SecretKey=${STRIPE_SECRET_KEY}
      - StripeConfiguration__PublishableKey=${STRIPE_PUBLISHABLE_KEY}
      - StripeConfiguration__WebhookSecret=${STRIPE_WEBHOOK_SECRET}
      - StripeConfiguration__SuccessUrl=${STRIPE_SUCCESS_URL}
      - StripeConfiguration__CancelUrl=${STRIPE_CANCEL_URL}
      - StripeConfiguration__Currency=${STRIPE_CURRENCY}
      - Services__User__GrpcUrl=http://user-service:6116
      - Services__Appointment__GrpcUrl=http://appointment-service:6102
    networks:
      - bookingcare-network
    restart: unless-stopped

  review-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-review-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_review_service
    ports:
      - "6012:6012"
      - "6112:6112"
    depends_on:
      mongodb:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6012;http://+:6112
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - MongoDbSettings__ConnectionString=${MONGODB_CONNECTION_STRING}
      - MongoDbSettings__DatabaseName=MABS_Reviews
      - Services__Auth__GrpcUrl=http://auth-service:6103
      - Services__User__GrpcUrl=http://user-service:6116
      - Services__Appointment__GrpcUrl=http://appointment-service:6102
    networks:
      - bookingcare-network
    restart: unless-stopped

  saga-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-saga-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_saga_service
    ports:
      - "6013:6013"
      - "6113:6113"
    depends_on:
      sqlserver-saga:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6013;http://+:6113
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - Saga__ConnectionString=${SAGA_CONNECTION_STRING}
    networks:
      - bookingcare-network
    restart: unless-stopped

  schedule-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-schedule-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_schedule_service
    ports:
      - "6014:6014"
      - "6114:6114"
    depends_on:
      sqlserver-schedule:
        condition: service_healthy
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6014;http://+:6114
      - ConnectionStrings__DefaultConnection=${SCHEDULE_CONNECTION_STRING}
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - Cache__ConnectionString=${REDIS_CONNECTION_STRING}
      - RabbitMQ__HostName=${RABBITMQ_HOSTNAME}
      - RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
      - RabbitMQ__Password=${RABBITMQ_DEFAULT_PASS}
      - RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
      - GrpcClients__Doctor__Address=http://doctor-service:6108
      - GrpcClients__ServiceMedical__Address=http://servicemedical-service:6115
      - GrpcClients__Appointment__Address=http://appointment-service:6102
    networks:
      - bookingcare-network
    restart: unless-stopped

  servicemedical-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-servicemedical-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_servicemedical_service
    ports:
      - "6015:6015"
      - "6115:6115"
    depends_on:
      sqlserver-servicemedical:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6015;http://+:6115
      - ConnectionStrings__DefaultConnection=${SERVICEMEDICAL_CONNECTION_STRING}
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - GrpcClients__Hospital__Address=http://hospital-service:6104
      - GrpcClients__Review__Address=http://review-service:6112
      - HospitalService__BaseUrl=http://hospital-service:6104
      - AWS__S3__AccessKey=${S3_ACCESS_KEY}
      - AWS__S3__SecretKey=${S3_SECRET_KEY}
      - AWS__S3__BucketName=${S3_BUCKET_NAME}
      - AWS__S3__Region=${S3_REGION}
    networks:
      - bookingcare-network
    restart: unless-stopped

  user-service:
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-user-service:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_user_service
    ports:
      - "6016:6016"
      - "6116:6116"
    depends_on:
      sqlserver-user:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    environment:
      - ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT}
      - ASPNETCORE_URLS=http://+:6016;http://+:6116
      - ConnectionStrings__DefaultConnection=${USER_CONNECTION_STRING}
      - Jwt__SecretKey=${JWT_KEY}
      - Jwt__Issuer=${JWT_ISSUER}
      - Jwt__Audience=${JWT_AUDIENCE}
      - RabbitMQ__HostName=${RABBITMQ_HOSTNAME}
      - RabbitMQ__UserName=${RABBITMQ_DEFAULT_USER}
      - RabbitMQ__Password=${RABBITMQ_DEFAULT_PASS}
      - RabbitMQ__VirtualHost=${RABBITMQ_DEFAULT_VHOST}
      - AWS__S3__AccessKey=${S3_ACCESS_KEY}
      - AWS__S3__SecretKey=${S3_SECRET_KEY}
      - AWS__S3__BucketName=${S3_BUCKET_NAME}
      - AWS__S3__Region=${S3_REGION}
    networks:
      - bookingcare-network
    restart: unless-stopped

  ui-user:
    build:
      context: ../booking-care-system-ui
      dockerfile: Dockerfile
      args:
        - VITE_API_URL=${VITE_API_URL}
        - VITE_RECAPTCHA_SITE_KEY=${VITE_RECAPTCHA_SITE_KEY}
        - VITE_GOOGLE_CLIENT_ID=${VITE_GOOGLE_CLIENT_ID}
        - VITE_FACEBOOK_APP_ID=${VITE_FACEBOOK_APP_ID}
        - VITE_DEVICE_ID=${VITE_DEVICE_ID}
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-frontend:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_ui_user
    ports:
      - "5173:80"
    depends_on:
      - api-gateway
    networks:
      - bookingcare-network
    healthcheck:
      test:
        [
          "CMD",
          "wget",
          "--quiet",
          "--tries=1",
          "--spider",
          "http://localhost:80/",
        ]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  ui-admin:
    build:
      context: ../booking-care-system-ui-admin
      dockerfile: Dockerfile
      args:
        - VITE_API_URL=${VITE_API_URL}
        - VITE_RECAPTCHA_SITE_KEY=${VITE_RECAPTCHA_SITE_KEY}
        - VITE_GOOGLE_CLIENT_ID=${VITE_GOOGLE_CLIENT_ID}
        - VITE_FACEBOOK_APP_ID=${VITE_FACEBOOK_APP_ID}
        - MABS_APP_NAME=${MABS_APP_NAME}
    image: ${DOCKER_USERNAME:-hiumx}/bookingcare-frontend-admin:${VERSION:-latest}
    platform: linux/amd64
    container_name: bookingcare_ui_admin
    ports:
      - "5174:80"
    depends_on:
      - api-gateway
    networks:
      - bookingcare-network
    healthcheck:
      test:
        [
          "CMD",
          "wget",
          "--quiet",
          "--tries=1",
          "--spider",
          "http://localhost:80/",
        ]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s
    restart: unless-stopped

volumes:
  rabbitmq_data:
  redis_data:
  mongodb_data:
  sqlserver_discount_data:
  sqlserver_saga_data:
  sqlserver_user_data:
  sqlserver_doctor_data:
  sqlserver_auth_data:
  sqlserver_appointment_data:
  sqlserver_hospital_data:
  sqlserver_schedule_data:
  sqlserver_payment_data:
  sqlserver_servicemedical_data:
  sqlserver_ai_data:
  sqlserver_content_data:
  prometheus_data:
  grafana_data:

networks:
  bookingcare-network:
    driver: bridge
